{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Litex SOC with Advanced Interrupt Architecture","text":""},{"location":"#introduction","title":"Introduction","text":"<p>By integrating RISC-V Advanced Interrupt Architecture (AIA) support into the LiteX SoC framework, we aim to enhance LiteX with modern interrupt handling capabilities that support message-signaled interrupts (MSIs), virtualization, and improved scalability for multi-core systems.</p>"},{"location":"#background","title":"Background","text":"<p>The RISC-V Advanced Interrupt Architecture (AIA) represents the next generation of interrupt handling for RISC-V systems, offering significant advantages over traditional interrupt controllers:</p> <ul> <li>Message-Signaled Interrupts (MSIs): Direct support for PCIe and other modern peripheral standards</li> <li>Virtualization Support: Hardware-assisted interrupt virtualization for guest VMs</li> <li>Scalability: Support for up to 16,384 harts with thousands of interrupt sources</li> <li>Flexible Priority Management: Software-configurable interrupt priorities across all interrupt types</li> <li>Improved Latency: Hardware acceleration for interrupt delivery and handling</li> </ul>"},{"location":"#aia-vs-clic-feature-comparison","title":"AIA vs CLIC Feature Comparison","text":"Feature CLIC AIA Interrupt Sources Up to 4096 Up to 2047 per IMSIC Priority Levels 256 levels Configurable priorities Hardware Vectoring Selective Via IMSIC MSI Support No Native Virtualization Limited Full support Multi-core Scaling Limited Up to 16,384 harts Preemption Level-based Priority-based Software Complexity Lower Higher Hardware Complexity Lower Higher Industry Adoption Growing Standardized"},{"location":"#implementation-complexity-analysis","title":"Implementation Complexity Analysis","text":""},{"location":"#clic-implementation","title":"CLIC Implementation","text":"<ul> <li>Advantages: Simpler hardware, lower latency for real-time</li> <li>Disadvantages: No MSI support, limited virtualization</li> </ul>"},{"location":"#aia-implementation","title":"AIA Implementation","text":"<ul> <li>Advantages: Future-proof, comprehensive feature set</li> <li>Disadvantages: Higher complexity, more resources</li> </ul>"},{"location":"Architecture/","title":"AIA LiteX SoC Framework Architecture","text":""},{"location":"Architecture/#core-components-integration","title":"Core Components Integration","text":"<p>We propose implementing the following AIA components in LiteX:</p> <ol> <li>IMSIC (Incoming MSI Controller)</li> <li>One IMSIC per VexRiscv core</li> <li>Support for machine and supervisor-level interrupt files</li> <li> <p>Initial implementation without guest interrupt files</p> </li> <li> <p>APLIC (Advanced Platform-Level Interrupt Controller)</p> </li> <li>Centralized interrupt routing for wired interrupts</li> <li>Support for both direct delivery and MSI forwarding modes</li> <li> <p>Hierarchical domain support for M-mode and S-mode</p> </li> <li> <p>ACLINT Compatibility</p> </li> <li>Maintain backward compatibility with existing timer and software interrupt mechanisms</li> <li>Implement as separate MTIMER and MSWI devices per AIA specification</li> </ol>"},{"location":"Architecture/#system-architecture","title":"System Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  VexRiscv   \u2502     \u2502  VexRiscv   \u2502     \u2502  VexRiscv   \u2502\n\u2502    Core 0   \u2502     \u2502    Core 1   \u2502     \u2502    Core N   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502                   \u2502                   \u2502\n    \u250c\u2500\u2500\u2534\u2500\u2500\u2510             \u250c\u2500\u2500\u2534\u2500\u2500\u2510             \u250c\u2500\u2500\u2534\u2500\u2500\u2510\n    \u2502IMSIC\u2502             \u2502IMSIC\u2502             \u2502IMSIC\u2502\n    \u2502  0  \u2502             \u2502  1  \u2502             \u2502  N  \u2502\n    \u2514\u2500\u2500\u252c\u2500\u2500\u2518             \u2514\u2500\u2500\u252c\u2500\u2500\u2518             \u2514\u2500\u2500\u252c\u2500\u2500\u2518\n       \u2502                   \u2502                   \u2502\n       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                          \u2502\n                    \u250c\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510\n                    \u2502   APLIC   \u2502\n                    \u2502           \u2502\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518\n                          \u2502\n                \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                \u2502 Peripheral Devices\u2502\n                \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"Architecture/#software-architecture","title":"Software Architecture","text":""},{"location":"Architecture/#driver-stack-overview","title":"Driver Stack Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    User Applications    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502     Linux Kernel        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502   IRQ Domain Subsystem  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  AIA Driver Framework   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  APLIC   \u2502    IMSIC     \u2502\n\u2502  Driver  \u2502    Driver    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"Architecture/#key-software-components","title":"Key Software Components","text":"<ol> <li>APLIC Driver</li> <li>Device initialization</li> <li>Interrupt routing configuration</li> <li>Domain management</li> <li> <p>MSI address generation</p> </li> <li> <p>IMSIC Driver</p> </li> <li>Interrupt file management</li> <li>CSR access abstraction</li> <li>Priority handling</li> <li> <p>Vector table management</p> </li> <li> <p>Integration Layer</p> </li> <li>IRQ domain mapping</li> <li>Device tree parsing</li> <li>Legacy compatibility</li> <li>Performance monitoring</li> </ol>"},{"location":"Roadmap/","title":"Roadmap","text":""},{"location":"Roadmap/#implementation-roadmap","title":"Implementation Roadmap","text":""},{"location":"Roadmap/#phase-1-foundation","title":"Phase 1: Foundation","text":""},{"location":"Roadmap/#11-core-infrastructure","title":"1.1 Core Infrastructure","text":"<ul> <li> Define AIA memory map regions in LiteX</li> <li> Create base classes for AIA components</li> <li> Implement CSR extensions for VexRiscv (Smaia)</li> <li> Setup interrupt routing infrastructure</li> </ul>"},{"location":"Roadmap/#12-aclint-implementation","title":"1.2 ACLINT Implementation","text":"<ul> <li> Implement MTIMER device</li> <li> Implement MSWI device</li> <li> Ensure backward compatibility with existing CLINT</li> <li> Create device tree bindings</li> </ul>"},{"location":"Roadmap/#phase-2-aplic-development","title":"Phase 2: APLIC Development","text":""},{"location":"Roadmap/#21-basic-aplic","title":"2.1 Basic APLIC","text":"<ul> <li> Implement APLIC register interface</li> <li> Support for up to 1023 interrupt sources</li> <li> Direct delivery mode implementation</li> <li> Basic interrupt routing logic</li> </ul>"},{"location":"Roadmap/#22-advanced-aplic-features","title":"2.2 Advanced APLIC Features","text":"<ul> <li> MSI delivery mode support</li> <li> Hierarchical domain implementation</li> <li> Interrupt delegation between M/S modes</li> <li> Integration with system bus</li> </ul>"},{"location":"Roadmap/#phase-3-imsic-integration","title":"Phase 3: IMSIC Integration","text":""},{"location":"Roadmap/#31-imsic-core","title":"3.1 IMSIC Core","text":"<ul> <li> Implement interrupt file structure</li> <li> MSI reception and recording logic</li> <li> CSR interface (mtopei, stopei)</li> <li> Interrupt priority handling</li> </ul>"},{"location":"Roadmap/#32-imsic-aplic-integration","title":"3.2 IMSIC-APLIC Integration","text":"<ul> <li> MSI forwarding from APLIC to IMSIC</li> <li> Unified interrupt routing</li> <li> Performance optimization</li> <li> Multi-core synchronization</li> </ul>"},{"location":"Roadmap/#phase-4-software-support","title":"Phase 4: Software Support","text":""},{"location":"Roadmap/#41-bare-metal-support","title":"4.1 Bare-metal Support","text":"<ul> <li> AIA initialization routines</li> <li> Interrupt handler templates</li> <li> Driver API for APLIC/IMSIC</li> <li> Example applications</li> </ul>"},{"location":"Roadmap/#42-linux-support","title":"4.2 Linux Support","text":"<ul> <li> Device tree bindings</li> <li> Linux interrupt controller drivers</li> <li> Integration with existing IRQ subsystem</li> <li> Performance benchmarking tools</li> </ul>"},{"location":"Roadmap/#phase-5-verification--testing","title":"Phase 5: Verification &amp; Testing","text":""},{"location":"Roadmap/#51-compliance-testing","title":"5.1 Compliance Testing","text":"<ul> <li> RISC-V AIA specification compliance</li> <li> Interrupt latency measurements</li> <li> Priority handling verification</li> <li> Multi-core stress testing</li> </ul>"},{"location":"Roadmap/#52-system-integration","title":"5.2 System Integration","text":"<ul> <li> Full SoC integration testing</li> <li> Peripheral interrupt testing</li> <li> Software compatibility validation</li> <li> Documentation completion</li> </ul>"},{"location":"Roadmap/#benefits-over-clic","title":"Benefits Over CLIC","text":"<p>While CLIC offers excellent real-time capabilities, AIA provides:</p> <ol> <li>Better Scalability: Designed for systems with thousands of cores</li> <li>MSI Support: Native support for modern peripheral standards</li> <li>Virtualization: Hardware support for interrupt virtualization</li> <li>Industry Alignment: Broader ecosystem support and standardization</li> <li>Flexibility: Modular design allows partial implementation</li> </ol>"},{"location":"Roadmap/#conclusion","title":"Conclusion","text":"<p>Implementing AIA support in LiteX positions the framework at the forefront of RISC-V interrupt architecture evolution. This enhancement will enable LiteX-based SoCs to support modern peripherals, virtualization, and scale to larger multi-core systems while maintaining the framework's ease of use and flexibility.</p> <p>The modular approach allows for incremental implementation, reducing risk while delivering value at each phase. With proper execution, LiteX will become the go-to platform for exploring and deploying advanced RISC-V interrupt architectures.</p>"}]}